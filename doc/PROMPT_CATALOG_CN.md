# Memex 系统提示词 (Prompts) 清单与说明

本文档梳理了系统中当前使用的所有提示词（Prompts），说明其用途、位置以及配置方式。

> **更新状态**: 所有核心提示词均已迁移至 **Prompt Lab** (数据库托管)，支持热更新。

## 提示词类型说明

*   **✅ 动态配置 (Dynamic)**: 代码中通过 `prompt_manager` 读取，支持数据库覆盖。如果数据库中没有配置，则使用代码中的默认值。可以通过 API 或数据库修改，无需重启。
*   **💾 数据库预设 (DB Seed)**: 系统自动初始化的默认配置，存储于 `prompt_configs` 表中。

## 详细清单

### 1. 核心路由 (Router)
负责理解用户意图，决定是搜索知识库、读取文件还是闲聊。

| 提示词 Key | 显示角色 (Role) | 用途说明 | 修改后影响 |
| :--- | :--- | :--- | :--- |
| **`system.router_main`** | **⚖️ 意图法官** | **意图识别主脑**。分析用户输入，输出 JSON 控制信号（如 `needs_search`, `keywords`）。 | 极高风险。控制系统核心理解能力和工具调用逻辑。 |

### 2. 归档与感知 (Archivist & Vision)
负责处理用户上传的文件和图片。

| 提示词 Key | 显示角色 (Role) | 用途说明 | 修改后影响 |
| :--- | :--- | :--- | :--- |
| **`system.file_analyze`** | **🗂️ 归档分析员** | **文件分析**。从文档中提取元数据（标题、标签、分类、摘要）并生成规范文件名。 | 影响文件归档的质量和检索字段的准确性。 |
| **`vision.analyze`** | **👁️ 视觉分析员** | **视觉理解**。分析图片内容，提取 OCR 文字、场景描述和物体列表（JSON 格式）。 | 影响图片搜索的召回率（依赖 OCR 和描述）。 |

### 3. 知识库整理 (Gardener)
负责后台自动整理、切分和丰富上传的文档（通常在夜间运行）。

| 提示词 Key | 显示角色 (Role) | 用途说明 | 修改后影响 |
| :--- | :--- | :--- | :--- |
| **`gardener.semantic_split`** | **🔪 语义手术刀** | **语义切分**。指导 AI 将长文章切分成独立的、语义完整的段落。 | 影响搜索结果的精准度。切得太碎或太粗都会影响召回。 |
| **`gardener.context_enrich`** | **🌱 语境补全师** | **上下文补充**。为每个切片补充缺失的主语或背景（如将“他”替换为具体人名）。 | 增强“片段”的独立可读性。 |

### 4. 任务与报表 (Tasks & Reports)
特定功能的辅助提示词，用于生成摘要和日报。

| 提示词 Key | 显示角色 (Role) | 用途说明 | 修改后影响 |
| :--- | :--- | :--- | :--- |
| **`tasks.summarization`** | **📝 摘要生成员** | **记忆压缩**。将长对话历史或长文档压缩为简短摘要。 | 影响多轮对话的记忆能力和 token 消耗。 |
| **`chat_distiller.daily_report`** | **📰 日报主编** | **对话日报**。分析一天的对话记录，提取主题、结论和待办事项。 | 影响每日回顾的质量。 |
| **`tasks.daily_briefing`** | **📈 简报生成员** | **归档简报**。阅读过去 24 小时归档的文件摘要，生成每日阅读简报。 | 影响用户对新知识的获取效率。 |

### 5. 系统对话 (System)
负责最终生成回复给用户。

| 提示词 Key | 显示角色 (Role) | 用途说明 | 修改后影响 |
| :--- | :--- | :--- | :--- |
| **`system.chat_default`** | **🎓 Memex 助手** | **默认人设**。系统的最终对外发言人，负责综合检索结果回答用户。 | 影响 AI 的说话语气、性格和最终回复的可读性。 |

---

## 我该如何修改？

现在所有提示词都已统一由 `PromptManager` 管理。

### 修改方法
1.  **数据库修改 (推荐)**: 在 `prompt_configs` 表中找到对应的 `key`，修改 `content` 字段。修改后立即生效（热更新）。
2.  **API 修改**: 调用 `POST /api/prompts/{key}` 接口进行更新。
3.  **代码默认值**: 修改 `src/core/prompt_manager.py` 中的 `defaults` 列表。注意：这只会在新环境下生效，不会覆盖数据库中已有的配置。

### 已废弃 (Deprecated)
以下提示词已被新版替代或删除，不再使用：
*   `system.chat_system_prompt` (已合并至 `system.chat_default`)
*   `system.router_schema` (逻辑已内嵌至 `system.router_main`)
*   `system.router_v2` (已重命名/合并)
